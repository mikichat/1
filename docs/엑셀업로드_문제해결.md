# 🔧 엑셀 업로드 문제 해결

## ✅ 수정 완료 사항

### 1. 파싱 로직 대폭 개선
- **전체 셀 스캔** - 모든 행과 열을 순회하며 데이터 찾기
- **유연한 키워드 매칭** - 정확한 위치가 아니어도 키워드만 있으면 인식
- **패턴 인식** - 날짜, 전화번호, 이메일 자동 인식

### 2. 날짜 변환 강화
- 엑셀 숫자 날짜 (예: 45234)
- YYYY-MM-DD 형식
- YYYY.MM.DD 형식
- YYYY/MM/DD 형식
- YYYYMMDD 형식
- MM/DD/YYYY 형식

### 3. 미리보기 개선
- 아이콘 추가로 가독성 향상
- 추출된 항목별 색상 구분
- 데이터 없을 때 상세한 안내

### 4. 디버깅 강화
- 콘솔에 상세 로그 출력
- 단계별 확인 가능
- 오류 발생 시 구체적 메시지

---

## 🧪 테스트 방법

### Step 1: 브라우저 콘솔 열기
```
Chrome: F12 또는 Ctrl+Shift+I
Firefox: F12
Safari: Cmd+Option+I
```

### Step 2: 엑셀 파일 업로드
```
1. excel-import.html 열기
2. 샘플 파일 업로드
3. 콘솔 확인
```

### Step 3: 콘솔 확인 사항
```
✅ "워크북 로드 성공"
✅ "시트 목록: [...]"
✅ "시트 데이터 읽기 성공, 행 수: X"
✅ "첫 5행: [...]"
✅ "원본 데이터: [...]"
✅ "제목 발견: ..."
✅ "시작일 발견: ..."
✅ "최종 추출 데이터: {...}"
```

---

## 📊 샘플 파일 분석

### 예상되는 파일 구조

**케이스 1: 확정서 형식**
```
┌─────────────────────────────────┐
│ 다낭 골프 여행 확정서           │
├─────────────────────────────────┤
│ 여행 기간: 2024-11-12 ~ 11-15  │
│ 출발 공항: 인천국제공항         │
│ 도착 공항: 다낭국제공항         │
│ 숙소: 그랜드 호텔               │
│ 담당자: 홍길동                   │
│ 연락처: 010-1234-5678           │
└─────────────────────────────────┘
```

**케이스 2: 표 형식**
```
| 항목       | 내용            |
|------------|-----------------|
| 여행명     | 다낭 골프 여행  |
| 출발일     | 2024-11-12      |
| 도착일     | 2024-11-15      |
| 담당자     | 홍길동          |
```

**케이스 3: 자유 형식**
```
다낭 골프 여행
2024년 11월 12일 ~ 15일
인천 출발, 다낭 도착
담당: 홍길동 (010-1234-5678)
```

---

## 🔍 인식되는 키워드

### 여행 제목
- "여행", "패키지", "확정서" 포함된 긴 텍스트
- 또는 첫 번째로 나오는 긴 텍스트 (10자 이상)

### 날짜
- "출발일", "시작일", "가는날" 키워드
- "도착일", "종료일", "오는날" 키워드
- 날짜 패턴 (YYYY-MM-DD 형식 등)
- 기간 표시 (~ 포함)

### 공항
- "출발공항", "출발 공항"
- "도착공항", "도착 공항"
- "항공", "출발편", "귀국편"

### 숙소
- "숙소", "호텔", "리조트"
- 다음 셀에 숙소명

### 회사/담당자
- "회사명", "회사"
- "담당자", "담당", "연락처"
- 이메일 패턴 (@포함)
- 전화번호 패턴 (010-XXXX-XXXX)

---

## 🛠️ 문제 해결 가이드

### 문제 1: "추출된 데이터가 없습니다"

**원인:**
- 키워드가 없거나 인식 불가
- 첫 번째 시트가 비어있음
- 데이터 형식이 특이함

**해결:**
1. 브라우저 콘솔 확인
2. "원본 데이터" 로그 확인
3. 어떤 키워드가 인식되었는지 확인
4. 키워드 추가 필요시 요청

### 문제 2: 날짜가 이상하게 나옴

**원인:**
- 엑셀 날짜가 텍스트로 저장됨
- 특이한 날짜 형식

**해결:**
1. 콘솔에서 "날짜" 관련 로그 확인
2. 엑셀에서 날짜를 `YYYY-MM-DD` 형식으로 변경
3. 또는 미리보기 후 수동 수정

### 문제 3: 일부만 추출됨

**원인:**
- 정상입니다! 일부 정보는 수동 입력 설계

**자동 추출:**
- ✅ 제목, 날짜, 공항, 숙소, 회사 정보

**수동 입력:**
- ❌ 골프장 & TEE-UP
- ❌ 일정 상세
- ❌ 이미지

### 문제 4: 파일 업로드 자체가 안됨

**확인 사항:**
1. 파일 확장자 (.xlsx 또는 .xls)
2. 파일 크기 (10MB 이하)
3. 파일 손상 여부
4. 브라우저 호환성

---

## 💡 디버깅 팁

### Tip 1: 콘솔 로그 활용
```javascript
// 콘솔에서 확인할 수 있는 정보:
- 워크북 로드 여부
- 시트 목록
- 원본 데이터 (배열)
- 발견된 항목들
- 최종 추출 데이터
```

### Tip 2: 테스트 페이지 사용
```
test-excel.html 열기
→ 엑셀 파일 업로드
→ 전체 구조 확인
```

### Tip 3: 단계별 확인
```
1. 파일 업로드 → "워크북 로드 성공"
2. 데이터 읽기 → "시트 데이터 읽기 성공"
3. 파싱 → "제목 발견", "날짜 발견" 등
4. 완료 → "최종 추출 데이터"
```

---

## 🎯 추천 엑셀 형식

### 가장 잘 인식되는 형식

```
┌────────────────┬───────────────────┐
│ 여행명         │ 다낭 골프 여행    │
│ 출발일         │ 2024-11-12        │
│ 도착일         │ 2024-11-15        │
│ 출발공항       │ 인천국제공항      │
│ 도착공항       │ 다낭국제공항      │
│ 출발편         │ VJ123 07:00       │
│ 숙소           │ 그랜드 호텔       │
│ 회사명         │ (주)여행세상      │
│ 담당자         │ 홍길동            │
│ 담당자 전화    │ 010-1234-5678     │
│ 담당자 이메일  │ hong@company.com  │
└────────────────┴───────────────────┘
```

**핵심 원칙:**
1. **2열 구조** - 항목명 | 값
2. **명확한 키워드** - "여행명", "출발일" 등
3. **날짜 형식** - YYYY-MM-DD
4. **하나의 시트** - 첫 번째 시트에 모든 정보

---

## 🔄 다음 단계

### 현재 샘플 파일이 인식 안될 경우

1. **test-excel.html 사용**
   ```
   test-excel.html 열기
   → 샘플 파일 업로드
   → 전체 구조 확인
   → 스크린샷 공유
   ```

2. **콘솔 로그 복사**
   ```
   F12 → Console 탭
   → 모든 로그 복사
   → 공유
   ```

3. **엑셀 파일 구조 설명**
   ```
   몇 행 몇 열인지
   어떤 정보가 어디에 있는지
   특이한 형식이 있는지
   ```

---

## ✅ 개선된 기능 요약

1. **전체 셀 스캔** - 어디에 있든 찾아냄
2. **유연한 키워드** - 부분 매칭, 대소문자 무시
3. **패턴 인식** - 날짜, 전화번호, 이메일 자동 인식
4. **상세 로그** - 무엇이 인식되었는지 콘솔에 표시
5. **오류 처리** - 명확한 오류 메시지

---

## 📞 추가 지원

샘플 파일이 여전히 인식되지 않으면:
1. 브라우저 콘솔 전체 로그 복사
2. 또는 test-excel.html 사용하여 구조 확인
3. 엑셀 파일 구조 설명

그러면 맞춤형 파싱 로직을 추가하겠습니다! 😊
